id: vulnlab-nextjs-all

info:
  name: VulnLab Next.js – All Vulnerability Simulations
  author: vulnlab-edu
  severity: info
  description: |
    Master template that tests all VulnLab endpoints on the Next.js version
    (running locally or on Vercel). All responses are static simulations.
    FOR EDUCATIONAL USE ONLY.
  tags: vulnlab,nextjs,misconfiguration,sqli,xss,ssrf,lfi,redirect,cve

# ─── A. MISCONFIGURATION ───────────────────────────────────────────────────

http:
  # 1. .env exposure
  - id: env-exposure
    method: GET
    path:
      - "{{BaseURL}}/.env"
      - "{{BaseURL}}/api/vuln-lab/env"
    matchers-condition: and
    matchers:
      - type: word
        words: ["FAKE_SECRET_000", "DUMMY_DB_PASS"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: Misconfiguration
      severity: critical

  # 2. .git/config exposure
  - id: git-config
    method: GET
    path:
      - "{{BaseURL}}/.git/config"
      - "{{BaseURL}}/api/vuln-lab/git-config"
    matchers-condition: and
    matchers:
      - type: word
        words: ["[core]", "DUMMY_GIT_TOKEN"]
        condition: and
      - type: status
        status: [200]
    metadata:
      category: Misconfiguration
      severity: high

  # 3. config.json exposure
  - id: config-json
    method: GET
    path:
      - "{{BaseURL}}/config.json"
      - "{{BaseURL}}/api/vuln-lab/config-json"
    matchers-condition: and
    matchers:
      - type: word
        words: ["FAKE_API_KEY_12345", "DUMMY_DB_PASS"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: Misconfiguration
      severity: critical

  # 4. Directory listing
  - id: directory-listing
    method: GET
    path:
      - "{{BaseURL}}/uploads/"
      - "{{BaseURL}}/api/vuln-lab/uploads"
    matchers-condition: and
    matchers:
      - type: word
        words: ["database_dump.sql", "private_key.pem", "Index of /uploads/"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: Misconfiguration
      severity: medium

# ─── B. CVE FINGERPRINTS ───────────────────────────────────────────────────

  # 5. X-Jenkins header on any page
  - id: jenkins-header
    method: GET
    path:
      - "{{BaseURL}}/"
      - "{{BaseURL}}/vuln-lab"
    matchers:
      - type: word
        part: header
        words: ["2.150"]
    metadata:
      category: CVE Fingerprint
      severity: medium

  # 6. WordPress plugin CVE
  - id: wp-plugin-cve
    method: GET
    path:
      - "{{BaseURL}}/wp-plugin"
      - "{{BaseURL}}/api/vuln-lab/wp-plugin"
    matchers-condition: and
    matchers:
      - type: word
        words: ["CVE-2022-XXXX", "Vulnerable Plugin Version: 1.2.3"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: CVE Fingerprint
      severity: high

  # 7. Log4Shell JNDI
  - id: log4shell
    method: GET
    path:
      - "{{BaseURL}}/log4j-test"
      - "{{BaseURL}}/api/vuln-lab/log4j"
    matchers-condition: and
    matchers:
      - type: word
        words: ["JNDI lookup attempted", "CVE-2021-44228"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: CVE Fingerprint
      severity: critical

# ─── C. WEB VULNERABILITY PATTERNS ────────────────────────────────────────

  # 8. SQL Injection – error based
  - id: sqli-error
    method: GET
    path:
      - "{{BaseURL}}/search?q='"
      - "{{BaseURL}}/api/vuln-lab/search?q='"
    matchers-condition: and
    matchers:
      - type: word
        words: ["SQL syntax error", "SQLSTATE"]
        condition: or
      - type: status
        status: [500]
    metadata:
      category: SQL Injection
      severity: critical

  # 9. Reflected XSS
  - id: reflected-xss
    method: GET
    path:
      - "{{BaseURL}}/echo?msg=<script>alert('XSS_VULNLAB_TEST')</script>"
      - "{{BaseURL}}/api/vuln-lab/echo?msg=<script>alert('XSS_VULNLAB_TEST')</script>"
    matchers-condition: and
    matchers:
      - type: word
        words: ["<script>alert('XSS_VULNLAB_TEST')</script>"]
      - type: status
        status: [200]
    metadata:
      category: XSS
      severity: high

  # 10. SSRF – AWS Metadata
  - id: ssrf-metadata
    method: GET
    path:
      - "{{BaseURL}}/fetch?url=http://169.254.169.254/latest/meta-data/"
      - "{{BaseURL}}/api/vuln-lab/fetch?url=http://169.254.169.254/latest/meta-data/"
    matchers-condition: and
    matchers:
      - type: word
        words: ["FAKE_INSTANCE_ID", "FAKE_ACCESS_KEY_ID_META"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: SSRF
      severity: critical

  # 11. LFI – /etc/passwd
  - id: lfi-passwd
    method: GET
    path:
      - "{{BaseURL}}/page?file=../../../../etc/passwd"
      - "{{BaseURL}}/api/vuln-lab/page?file=../../../../etc/passwd"
    matchers-condition: and
    matchers:
      - type: word
        words: ["root:x:0:0:dummy-root", "vulnlab:x:1000"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: LFI
      severity: high

  # 12. Open Redirect
  - id: open-redirect
    method: GET
    path:
      - "{{BaseURL}}/redirect?next=https://evil-example.com/phishing"
      - "{{BaseURL}}/api/vuln-lab/open-redirect?next=https://evil-example.com/phishing"
    redirects: false
    matchers-condition: and
    matchers:
      - type: word
        part: header
        words: ["evil-example.com"]
      - type: status
        status: [302]
    metadata:
      category: Open Redirect
      severity: medium

  # 13. Default Credentials
  - id: default-creds
    method: POST
    path:
      - "{{BaseURL}}/api/vuln-lab/admin"
    body: '{"username":"admin","password":"admin123"}'
    headers:
      Content-Type: application/json
    matchers-condition: and
    matchers:
      - type: word
        words: ["FAKE_ADMIN_TOKEN", "Access Granted"]
        condition: or
      - type: status
        status: [200]
    metadata:
      category: Misconfiguration
      severity: critical
